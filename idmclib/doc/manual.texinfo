\input texinfo  @c -*-texinfo-*-
@c %**start of header
@afourpaper
@setfilename manual.info
@settitle Manual
@c %**end of header

@copying
This is the programmers manual of the idmclib C library

Copyright @copyright{} 2007 Marji Lines, Alfredo Medio
@end copying

@titlepage
@title idmclib programmers manual

@c The following two commands start the copyright page.
@page
@vskip 0pt plus 1filll
@insertcopying
@end titlepage

@c Output the table of contents at the beginning.
@contents

@ifnottex
@node Top
@top idmclib API

@insertcopying
@end ifnottex

@chapter Modules

The library is ideally divided in modules:
@table @samp
@item idmc_model
basic model allocation/methods
@item idmc_traj
trajectories (for discrete and continuous models) allocation/methods
@item idmc_lexp
Lyapunov spectrum for a given model (discrete and continuous)
@item idmc_cycles
basic period-k cycles finding support functions. Also a separate routine for eigenvalues modulus of real nonsimmetric matrices is provided
@item idmc_raster
mostly here for internal use. Data structures and methods for (integer) raster image manipulation. Used in the idmc_basin module
@item idmc_basin
fast algorithm for identifying basins of attraction of 2-dimensional maps
@item idmc_basin_slow
slow (but sometimes better) basins of attraction algorithm
@end table

@section Model
The model module is probably the most important module, as it contains all the base functions for model allocation and manipulation.

@example
int idmc_model_alloc(const char* buffer, const int buffer_len,
	idmc_model **s)
@end example

Allocates a new idmc model object, and eventually stores it in s. Can return the following error codes (@pxref{common-return-values,,common return values}):
@itemize @bullet
@item IDMC_OK
@item IDMC_EMEM
@item IDMC_ELUASYNTAX
@item IDMC_EMODEL
@end itemize

Only if the result is @code{IDMC_OK} in @code{s} is stored a pointer to a valid @code{idmc_model} object.
Whatever the result of @code{idmc_model_alloc}, you should free the memory after using the model object
by calling @code{idmc_model_free} (see below).

When syntax error occurs, a message with line reference is stored in the @code{s->errorMessage} slot.

@example
void idmc_model_free(idmc_model *s)
@end example

De-allocates a previously allocated model object. It is always safe to call @code{idmc_model_free}: @code{s} can be either
a @code{NULL} pointer, or a pointer to a partially initialized (because of errors) @code{idmc_model} object.

@example
idmc_model* idmc_model_clone(idmc_model *s)
@end example

Clones a model object. Returns a @code{NULL} pointer when memory issues.

@example
int idmc_model_setGslRngSeed(idmc_model *model, int seed)
@end example

Set RNG seed. Always returns @code{IDMC_OK}.

@example
int idmc_model_f(idmc_model *model, const double par[],
	const double var[], double f[])
int idmc_model_g(idmc_model *model, const double par[], 
	const double var[], double f[])
int idmc_model_Jf(idmc_model *model, const double par[],
	const double var[], double Jf[])
int idmc_model_Jg(idmc_model *model, const double par[],
	const double var[], double Jf[])
int idmc_model_NumJf(idmc_model *model, const double par[],
	const double var[], double Jf[],
	double util[], double util2[], double util3[])
@end example

Evaluate some model functions. These can return a runtime error, with relative message string stored in @code{model->errorMessage} buffer.

Accepted arguments:
@table @samp
@item model
@code{idmc_model} object
@item par, var
model parameters and variables values
@item f, Jf
result will be stored here
@item util, util2, util3
workspace pointers to a memory bloc of size: @code{model->nvar * sizeof(double)}
@end table

Return values: a common constant (@pxref{common-return-values,,common return values}).

@section Trajectory

Functions for trajectories computation.

@deftp {Data Type} idmc_trajectory
A discrete trajectory object, with the following slots:

@table @code
@item idmc_model* model
	@code{idmc_model} object
@item double* par
	parameters vector
@item double* var
current value
@item int step
current step number
@end table
@end deftp


@deftypefun int idmc_traj_trajectory_alloc @
	(idmc_model* @var{model}, double* @var{parValues}, @
		double* @var{varValues}, idmc_traj_trajectory** @var{ans})
	Allocate a new trajectory, with specified parameters and variables values. Result returned in @var{ans}.
@end deftypefun

@deftypefun void idmc_traj_trajectory_free (idmc_traj_trajectory* @var{traj})
	De-allocates a trajectory object.
@end deftypefun

@deftypefun int idmc_traj_trajectory_step (idmc_traj_trajectory* @var{traj})
Iterates one step on the trajectory object.
@end deftypefun

@deftp {Data Type} idmc_traj_ctrajectory
A continuous trajectory object, with the following slots:

@table @code
@item idmc_model* model
@item double* par
	parameters vector
@item double* var
	current value
@item double* error
@item double step_size
@item gsl_odeiv_step_type* step_function_code
@end table
@end deftp

A @code{idmc_traj_ctrajectory} object has the following methods:

@deftypefun int idmc_traj_ctrajectory_alloc (idmc_model* @var{model}, @
  double* @var{parValues}, double* @var{varValues}, @
  double @var{step_size}, gsl_odeiv_step_type* @var{step_function_code}, @
  idmc_traj_ctrajectory** @var{ans})
@end deftypefun
@deftypefun void idmc_traj_ctrajectory_free (idmc_traj_ctrajectory* @var{trajectory})
@end deftypefun
@deftypefun int idmc_traj_ctrajectory_step (idmc_traj_ctrajectory* @var{trajectory})
@end deftypefun
which are completely analogous to their discrete counterparts.

@c FIXME: fill better informations about 'step_function_code'

@section Basins of attraction
@deftypefun int idmc_basin_alloc (idmc_model* @var{m}, double* @var{parameters}, @
        double @var{xmin}, double @var{xmax}, int @var{xres}, @
        double @var{ymin}, double @var{ymax}, int @var{yres}, @
        int @var{attractorLimit}, int @var{attractorIterations}, @
        idmc_basin** @var{out_basin})
	Allocate new 'idmc_basin' object

@table @var
@item m
	model object (object is cloned)
@item parameters
	model parameters (vector will be copied)
@item xmin, xmax, xres
x axis range and resolution
@item ymin, ymax, yres
y axis range and resolution
@item attractorLimit
limit number of iterations before encountering an attractor
@item attractorIterations
limit number of iterations for drawing an attractor
@item out_basin
result object 
@end table

Returns an integer code as defined in @code{defines.h} (@pxref{common-return-values,,common return values}).

@end deftypefun

@deftypefun void idmc_basin_free (idmc_basin* @var{p})
	Deallocates an idmc_basin object.
@end deftypefun

@deftypefun int idmc_basin_step (idmc_basin* @var{p})
	Do one algorithm step.
@end deftypefun

@deftypefun int idmc_basin_finished (idmc_basin* @var{p})
	Check if algorithm has finished.
@end deftypefun

@section Slow Basins
Basins of attraction with slow algorithm

@deftypefun int idmc_basin_slow_alloc (idmc_model* @var{m}, double* @var{parameters}, @
	double @var{xmin}, double @var{xmax}, int @var{xres}, @
	double @var{ymin}, double @var{ymax}, int @var{yres}, @
	int @var{attractorLimit}, int @var{attractorIterations}, int @var{ntries}, @
	idmc_basin_slow** @var{out_basin})
Allocate new 'idmc_basin_slow' object
@table @var
@item m
model object (object is cloned)
@item parameters
model parameters (vector will be copied)
@item xmin, xmax, xres
x axis ranges and resolution
@item ymin, ymax, yres
y axis ranges and resolution
@item attractorLimit
limit number of iterations before encountering an attractor
@item attractorIterations
limit number of iterations for drawing an attractor
@item out_basin
result object
@end table
Returns an integer code as defined in 'defines.h' (@pxref{common-return-values,,common return values}).
@end deftypefun

@deftypefun void idmc_basin_slow_free (idmc_basin_slow* @var{p})
Deallocates an idmc_basin object
@end deftypefun

@deftypefun int idmc_basin_slow_init (idmc_basin_slow* @var{p})
Init basin (find attractors)
@end deftypefun

@deftypefun int idmc_basin_slow_step (idmc_basin_slow* @var{p})
Do one algorithm step
@end deftypefun

@deftypefun int idmc_basin_slow_finished (idmc_basin_slow* @var{p})
Check if algorithm finished
@end deftypefun

@section Periodic cycles

Functions for finding periodic cycles for a given dynamical system.

@deftypefun int idmc_cycles_find (idmc_model* @var{model}, @
  double* @var{parameters}, double* @var{start_point}, @
  int @var{power}, double @var{epsilon}, @
  int @var{max_iterations}, @
  double* @var{result}, double* @var{eigvals})
Try to find a cycle of period power for model @var{model} with parameters @var{parameters}.
You have to feed a starting point @var{start_point} for the Newton-type algorithm used,
the error tolerance @var{epsilon} and the max number of iterations @var{max_iterations}.
An arbitrary point of the cycle is stored in @var{result}.
In @var{eigvals} are stored modulus of eigenvalues associated with the cycle found (if any).
@end deftypefun

@example
int idmc_cycles_powf(idmc_model *model, int pow,
	double* par, double* var, double* ans)
@end example

Computes the @code{pow} iterate of model @code{model} with parameters @code{par} and values @code{var}.

@example
int idmc_cycles_powNumJac(idmc_model *model, int pow, double* par,
	double* var, double* Jf, double *util)
@end example

Numerically computes the jacobian of the powth iterate of model @code{model}
with parameters @code{par} in point @code{var}. The result matrix is stored in @code{Jf}.
@code{util} must point to a workspace memory of size @code{3 * (model->var_len)}.

@example
int idmc_cycles_eigval(double *mat, int dim, double *ans)
@end example

This is an utility function which computes (in @code{ans}) modulus of the eigenvalues of the
@code{dim} by @code{dim} real matrix @code{mat}.

@section Lyapunov exponents

Functions for numerical computation of Lyapunov exponents for discrete and continuous dynamical systems.

@example
int idmc_lexp(idmc_model* model, const double *par,
  double *startPoint, double *result, int iterations)
@end example

Compute Lyapunov exponents for discrete-time model @code{model} with parameters @code{par} in point @code{startPoint}.
Stores result in @code{result}. You must provide the number of map iterations.

@example
int idmc_lexp_ode(idmc_model* model, double *parameters,
	double *startPoint, double *result, double time, double step)
@end example

Compute Lyapunov exponents for continuous-time model @code{model} with parameters @code{parameters}
in point @code{startPoint}. Stores result in @code{result}. You must provide the time span @code{time}
and the integration step @code{step}.

@section Version info

There are 3 basic functions for version info retrievial:

@example
int idmc_version_major()
int idmc_version_minor()
int idmc_version_micro()
@end example

Their meaning should be evident.

@chapter Constants

The @code{defines.h} header defines the constants described below.

@table @samp
@item IDMC_EPS_VALUE
precision value for numerical derivative approximation
@end table

@anchor{common-return-values}
The following are generic return codes for (almost) all library functions.
@table @samp
@item IDMC_OK
normal operation

@item IDMC_EMEM
memory allocation error

@item IDMC_ELUASYNTAX
syntax error from lua itself

@item IDMC_ERUN
lua runtime error

@item IDMC_EMODEL
malformed model

@item IDMC_EERROR
inconsistent state (disaster)

@item IDMC_EMATH
algorithm failed

@item IDMC_EINT
interrupted by request
@end table

@bye
